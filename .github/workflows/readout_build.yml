name: Readout Tool Build
on: 
  push:
    paths:
    - 'rust/readaout/**'
    - 'lib/include/**'
  workflow_dispatch:  

env:
  CARGO_TERM_COLOR: always
  SOLUTION_FILE_PATH: .\rust\readout

jobs:
  build:
    runs-on: windows-latest
    defaults:
       run:
         shell: powershell
    env: 
          X86_REPO_LIB_PTH_COMMIT: ./lib/x86dummy/
          X64_REPO_LIB_PTH_COMMIT: ./lib/x64dummy/
          COMMIT_MSG: 'Internal build due to Dummy-Library code change' 
        
    steps:
    - name: Checkout Code
      uses: actions/checkout@v2
      # Inprovement: Uncomment & adjust if we can check out only: ./lib & ./dummy instead of the whole repository
      # with:
      #  path: ./dummy ./lib
    
    - name: Install LLVM and Clang
      uses: KyleMayes/install-llvm-action@v1
      with:
        version: "10.0"
        directory: ${{ runner.temp }}/llvm    
        
    - name: Show Environment Settings
      run: |
        rustup show
        ($env:PATH).split(";")
        ($env:LIBCLANG_PATH)="${{env.LD_LIBRARY_PATH}}".substring(0, "${{env.LD_LIBRARY_PATH}}".length - 1)
        ls ${{env:LIBCLANG_PATH}}
        rustup target add i686-pc-windows-msvc
        rustup show
        
        
    - name: Build x64
      run: |
        ls
        ($env:LIBCLANG_PATH)="${{env.LD_LIBRARY_PATH}}".substring(0, "${{env.LD_LIBRARY_PATH}}".length - 1)
        ls ${{env:LIBCLANG_PATH}}
        cd ${{env.SOLUTION_FILE_PATH}}
        cargo build --target-dir='Build_x64' --verbose

    # Assuming that 'stable-x86_64-pc-windows-msvc' is default
    
